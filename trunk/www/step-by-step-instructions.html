<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<style type="text/css">
  <!--
  .main-title, .main-details {
    font-size: 11pt;
  }
  
  .main-details {
    margin-top: 0.19in;
    margin-bottom: 0.19in
  }
  
  .main-title {
    font-weight: bold;
    margin-top: 0in;
    margin-bottom: 0.08in;
    border-bottom: thin solid black;
  }
  
  .build-step-title {
    font-size: 11pt;
    font-weight: bold;
    margin-top: 0.19in;
    margin-bottom: 0.19in
  }
  
  .build-step-details {
  }
  
  .build-step-code {
    font-family: "courier new", "courier", "monospace";
    border: 1px dashed;
    margin-right: 0.25in;
    padding: 2pt 4pt 2pt 4pt;
    background-color: #F0F0F0;
  }
  
  .build-step-details, .build-step-code, .build-step-title {
    margin-left: 0.25in;
  }
  
  table.build-step-details td {
    border-style: hidden;
  }
  -->
</style>

<h2 class="main-title">
  Step-by-step (walk-throughs) for building with edk2
</h2>

<p class="main-details">
  <font size="2">
    This page contains some step-by-step guides in an attempt to give
    a highly detailed description of how to set up building on an edk2
    system.&nbsp;
    A few different operating systems are targeted.&nbsp;
    It is hoped that these examples can either provide exact steps for
    setting up an edk2 build environment.&nbsp;
    If instructions are not available for your exact system configuration,
    you may still be able to 'tweak' the instructions to work on your
    system.
  </font>
</p>

<font size="2">
  <ul>
    <li><a href="#MacOSX10.5">Mac OS X 10.5</a> (Leopard)</li>
    <li><a href="#Ubuntu8.04">Ubuntu 8.04</a></li>
  </ul>
</font>

<h2 class="main-title">
  <a name="MacOSX10.5"></a>
  Mac OS X 10.5
</h2>

<h3 class="build-step-title">
  Work in progress...
</h3>

<!--
<p class="build-step-details">
  These instructions for OS X 10.5 are currently under construction.&nbsp;
  Please do not try to use them until this notice is removed!
</p>
-->

<h2 class="main-title">
  <a name="Ubuntu8.04"></a>
  Ubuntu 8.04
</h2>

<h3 class="build-step-title">
  Work in progress...
</h3>

<p class="build-step-details">
  These instructions for Ubuntu 8.04 are currently under construction.&nbsp;
  Please do not try to use them until this notice is removed!
</p>

<h3 class="build-step-title">
  Getting started &amp; Instructions for the instructions
</h3>

<p class="build-step-details">
  These instructions will be written as a series of commands executed from
  a command terminal.&nbsp;
  To open the command terminal application, open the "Applications" menu,
  then open the "Accessories" sub-menu, and then select the "Terminal"
  application.
</p>

<p class="build-step-details">
  Often these instructions will contain a command which needs to be
  executed in the terminal window.&nbsp; For example:
</p>

<pre class="build-step-code">
bash:~$ <b>echo this bold text is a sample command</b>
</pre>

<p class="build-step-details">
  To execute this command, highlight the <b>bold</b> text of the 
  command in your web browser.&nbsp;
  After the text is highlighted, you can paste the text into the terminal
  window with the middle mouse button.&nbsp;
</p>
<p class="build-step-details">
  There may be other ways to copy and paste the text into the terminal.&nbsp;
  For example, you can usually press 'Ctrl-C' within your web browser to copy
  the text, and within the gnome-terminal program you can then press
  'Ctrl-<b>Shift</b>-V' to paste the text.&nbsp;
  After pasting the command into the shell, you may need to press the
  enter or return key to execute the command.&nbsp;
  If all else fails, you can type the command by hand.
</p>

<p class="build-step-details">
  Some commands are very long, and we use the backslash character (\) to
  tell the shell program that the line is not finished.&nbsp; For example:
</p>

<pre class="build-step-code">
bash:~$ <b>echo this bold text is a sample command \
          which is broken into two lines</b>
</pre>

<p class="build-step-details">
  When you copy and paste, make sure you include all lines of the command.&nbsp;
  If you are typing the command, you can remove the backslash character (\)
  and combine the lines into a single line if you prefer.
</p>

<p class="build-step-details">
  If a command starts with the 'sudo' command, then you may be prompted for
  your user password.&nbsp;
  This will be the same password as you used to login to the system.
</p>

<p class="build-step-details">
  For the purposes of this set of instructions, we will be using the following
  paths.&nbsp;
</p>

<table class="build-step-details">
  <tr>
    <td>
      <a href="https://edk2.tianocore.org">Edk2</a> source tree:
    </td>
    <td>
      <b>~/src/edk2</b>
    </td>
  </tr>
  <tr>
    <td>
      <a href="https://buildtools.tianocore.org">Buildtools</a> source tree:
    </td>
    <td>
      <b>~/src/buildtools</b>
    </td>
  </tr>
  <tr>
    <td>
      gcc x64 cross-compiler installation:
    </td>
    <td>
      <b>~/programs/gcc/x64</b>
    </td>
  </tr>
</table>

<p class="build-step-details">
  You will need to change the commands if you want to use different
  locations, but this is not recommended unless you are sure that you
  know what you are doing.
</p>

<h3 class="build-step-title">
  Install tools from apt
</h3>

<p class="build-step-details">
  Several ubuntu packages will be needed to fully set up an edk2 build
  environment.&nbsp;
  In order to easily install all the requirements, you need to run
  this command.
</p>

<pre class="build-step-code">
bash:~$ <b>sudo apt-get install build-essentials uuid-dev \
          python-setuptools texinfo bison flex libgmp3-dev \
          libmpfr-dev</b>
</pre>

<h3 class="build-step-title">
  Install python antlr module
</h3>

<p class="build-step-details">
  In order to install the python antlr module, we use the 'easy_install'
  command.&nbsp;
  The following command is the latest version right now, but if
  you encounter difficulties, you may want to confirm the version at
  <a href="http://www.antlr.org/download/Python">http://www.antlr.org/download/Python</a>.
</p>

<pre class="build-step-code">
bash:~$ <b>sudo easy_install \
  http://www.antlr.org/download/Python/antlr_python_runtime-3.0.1-py2.5.egg</b>
</pre>

<h3 class="build-step-title">
  Get and build the edk2 BaseTools
</h3>

<p class="build-step-details">
  We will now check out the BaseTools source code using subversion.&nbsp;
  (If you are behind a web proxy, then you may need to configure your proxy
  in the ~/.subversion/servers file.)&nbsp;
</p>

<pre class="build-step-code">
bash:~$ <b>mkdir ~/src</b>
bash:~$ <b>cd ~/src</b>
bash:~$ <b>svn co \
  https://buildtools.tianocore.org/svn/buildtools/trunk/BaseTools</b>
bash:~$ <b>make -C BaseTools</b>
</pre>

<h3 class="build-step-title">
  Build <a href="http://gcc.gnu.org">gcc</a> x64 UEFI cross compiler
</h3>

<p class="build-step-details">
  In order to build UEFI images for x64, you will need to build a
  cross-compiler build of gcc.&nbsp;
  This can take quite a while to complete, possibly several hours on
  older systems.&nbsp;
  But, a Python script has been provided to automate this build process.&nbsp;
  Please note that if your network is behind a firewall, you may need to
  set the http_proxy environment variable:
</p>

<pre class="build-step-code">
Note: This is only needed if behind a internet firewall!
bash:~$ <b>export http_proxy=proxy.domain.com:proxy_port</b>
</pre>

<p class="build-step-details">
  To build gcc for x64, use these commands (this will take quite a while
  to complete):
</p>

<pre class="build-step-code">
bash:~$ <b>cd ~/src/BaseTools/gcc</b>
bash:~$ <b>./mingw-gcc-build.py --arch=x64 --prefix=~/programs/gcc/x64</b>
</pre>

<h3 class="build-step-title">
  Get the edk2 source tree
</h3>

<pre class="build-step-code">
bash:~$ <b>cd ~/src</b>
bash:~$ <b>svn co https://edk2.tianocore.org/svn/edk2/trunk/edk2</b>
</pre>

<h3 class="build-step-title">
  Setup build shell environment
</h3>

<pre class="build-step-code">
bash:~$ <b>cd ~/src/edk2</b>
bash:~$ <b>export EDK_TOOLS_PATH=~/src/BaseTools</b>
bash:~$ <b>. edksetup.sh BaseTools</b>
</pre>

<h3 class="build-step-title">
  Modify Conf files
</h3>

<p class="build-step-details">
  You will need to edit the Conf/tools_def.txt and Conf/target.txt files.&nbsp;
</p>

<p class="build-step-details">
  For the <i>Conf/tools_def.txt</i> file, find the following lines:
</p>

<pre class="build-step-code">
*_UNIXGCC_X64_CC_PATH               = DEF(UNIXGCC_X64_PETOOLS_PREFIX)/gcc
*_UNIXGCC_X64_SLINK_PATH            = DEF(UNIXGCC_X64_PETOOLS_PREFIX)/ar
*_UNIXGCC_X64_DLINK_PATH            = DEF(UNIXGCC_X64_PETOOLS_PREFIX)/ld
*_UNIXGCC_X64_ASM_PATH              = DEF(UNIXGCC_X64_PETOOLS_PREFIX)/gcc
*_UNIXGCC_X64_PP_PATH               = DEF(UNIXGCC_X64_PETOOLS_PREFIX)/gcc
*_UNIXGCC_X64_VFRPP_PATH            = DEF(UNIXGCC_X64_PETOOLS_PREFIX)/gcc
</pre>

<p class="build-step-details">
  And change the cooresponding lines to match these:
</p>

<pre class="build-step-code">
*_UNIXGCC_X64_CC_PATH               = ENV(HOME)/programs/gcc/x64/bin/x86_64-pc-mingw32-gcc
*_UNIXGCC_X64_SLINK_PATH            = ENV(HOME)/programs/gcc/x64/bin/x86_64-pc-mingw32-ar
*_UNIXGCC_X64_DLINK_PATH            = ENV(HOME)/programs/gcc/x64/bin/x86_64-pc-mingw32-ld
*_UNIXGCC_X64_ASM_PATH              = ENV(HOME)/programs/gcc/x64/bin/x86_64-pc-mingw32-gcc
*_UNIXGCC_X64_PP_PATH               = ENV(HOME)/programs/gcc/x64/bin/x86_64-pc-mingw32-gcc
*_UNIXGCC_X64_VFRPP_PATH            = ENV(HOME)/programs/gcc/x64/bin/x86_64-pc-mingw32-gcc
</pre>

<p class="build-step-details">
  For the <i>Conf/target.txt</i> file, find the following lines:
</p>

<pre class="build-step-code">
ACTIVE_PLATFORM       = Nt32Pkg/Nt32Pkg.dsc
TARGET_ARCH           = IA32
TOOL_CHAIN_TAG        = MYTOOLS
</pre>

<p class="build-step-details">
  And change the cooresponding lines to match these:
</p>

<pre class="build-step-code">
ACTIVE_PLATFORM       = MdeModulePkg/MdeModulePkg.dsc
TARGET_ARCH           = X64
TOOL_CHAIN_TAG        = UNIXGCC
</pre>

<h3 class="build-step-title">
  Build Hello World!&nbsp; (and the rest of MdeModulePkg)
</h3>

<p class="build-step-details">
  Now you should be able to simply run the <i>build</i> command to compile
  the MdeModulePkg.
</p>

<pre class="build-step-code">
bash:~$ <b>build</b>
</pre>

<p class="build-step-details">
  As a tangible result of the build, you should have the HelloWorld UEFI
  X64 application.&nbsp;
  If you have a X64 UEFI system available to you, then this application
  should be able to run successfully under the shell.
</p>

<pre class="build-step-code">
bash:~$ <b>ls Build/MdeModule/DEBUG_UNIXGCC/X64/HelloWorld.efi</b>
</pre>

